<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Elifoot Web</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0b6623;
  color: white;
  text-align: center;
}
button, select {
  padding: 8px 14px;
  margin: 5px;
  cursor: pointer;
}
.hidden { display: none; }
table {
  margin: 15px auto;
  border-collapse: collapse;
}
td, th {
  border: 1px solid white;
  padding: 6px 10px;
}
.highlight {
  background: gold;
  color: black;
}
small { color: #ddd; }
</style>
</head>

<body>

<h1>âš½ ELIFOOT WEB</h1>

<div id="screen-select">
  <h2>Escolha seu time</h2>
</div>

<div id="screen-game" class="hidden">
  <h2 id="teamName"></h2>

  <p>ðŸ’° Dinheiro: $<span id="money"></span></p>

  <p>
    ðŸ§  TÃ¡tica:
    <select id="tactic" onchange="saveGame()">
      <option value="ofensivo">Ofensivo</option>
      <option value="equilibrado">Equilibrado</option>
      <option value="defensivo">Defensivo</option>
    </select>
  </p>

  <p>Rodada <span id="round"></span>/<span id="totalRounds"></span></p>

  <button onclick="playRound()">â–¶ Jogar Rodada</button>
  <button onclick="showSquad()">ðŸ‘¥ Elenco</button>
  <button onclick="showMarket()">ðŸ’¸ Mercado</button>
  <button onclick="showTable()">ðŸ“Š ClassificaÃ§Ã£o</button>
  <button onclick="newGame()">ðŸ†• Novo Jogo</button>

  <div id="output"></div>
</div>

<script>
const KEY = "elifoot-save";

/* ================== TIMES ================== */
let teams = [
  {
    name: "Sparta FC",
    players: [
      { name: "Leonidas", pos: "ATA", atk: 80, def: 20, age: 27, peak: 28, price: 60 },
      { name: "Ajax", pos: "MEI", atk: 65, def: 50, age: 24, peak: 27, price: 50 },
      { name: "Hector", pos: "ZAG", atk: 30, def: 75, age: 30, peak: 29, price: 45 }
    ],
    pts: 0, gf: 0, ga: 0
  },
  {
    name: "Roma FC",
    players: [
      { name: "Cesar", pos: "ATA", atk: 75, def: 25, age: 26, peak: 28, price: 55 },
      { name: "Brutus", pos: "MEI", atk: 60, def: 55, age: 28, peak: 27, price: 48 },
      { name: "Maximus", pos: "ZAG", atk: 35, def: 70, age: 31, peak: 29, price: 42 }
    ],
    pts: 0, gf: 0, ga: 0
  }
];

/* ================== JOGO ================== */
let myTeam = "";
let money = 100;
let currentRound = 0;
let schedule = [];
let tactic = "equilibrado";

/* ================== TEMPORADA ================== */
function generateSeason() {
  let games = [];
  for (let i = 0; i < teams.length; i++) {
    for (let j = i + 1; j < teams.length; j++) {
      games.push({ h: teams[i].name, a: teams[j].name });
      games.push({ h: teams[j].name, a: teams[i].name });
    }
  }
  return games;
}

/* ================== SAVE ================== */
function saveGame() {
  tactic = document.getElementById("tactic").value;
  localStorage.setItem(KEY, JSON.stringify({
    teams, myTeam, money, currentRound, schedule, tactic
  }));
}

function loadGame() {
  const data = localStorage.getItem(KEY);
  if (!data) return false;
  const s = JSON.parse(data);
  teams = s.teams;
  myTeam = s.myTeam;
  money = s.money;
  currentRound = s.currentRound;
  schedule = s.schedule;
  tactic = s.tactic || "equilibrado";
  return true;
}

/* ================== START ================== */
const selectDiv = document.getElementById("screen-select");
const gameDiv = document.getElementById("screen-game");

function setupSelection() {
  teams.forEach(t => {
    const b = document.createElement("button");
    b.innerText = t.name;
    b.onclick = () => startGame(t.name);
    selectDiv.appendChild(b);
  });
}

function startGame(team) {
  myTeam = team;
  schedule = generateSeason();
  showGame();
  saveGame();
}

function showGame() {
  selectDiv.classList.add("hidden");
  gameDiv.classList.remove("hidden");
  document.getElementById("teamName").innerText = "Seu time: " + myTeam;
  document.getElementById("money").innerText = money;
  document.getElementById("round").innerText = currentRound + 1;
  document.getElementById("totalRounds").innerText = schedule.length;
  document.getElementById("tactic").value = tactic;
}

/* ================== FORÃ‡A ================== */
function teamStats(team) {
  let atk = 0, def = 0;
  team.players.forEach(p => { atk += p.atk; def += p.def; });

  if (team.name === myTeam) {
    if (tactic === "ofensivo") { atk *= 1.2; def *= 0.9; }
    if (tactic === "defensivo") { atk *= 0.85; def *= 1.25; }
  }
  return { atk, def };
}

function calcGoals(atk, def) {
  const base = atk - def;
  const rand = Math.floor(Math.random() * 4);
  return Math.max(0, Math.min(6, Math.floor((base + rand) / 40)));
}

/* ================== EVOLUÃ‡ÃƒO ================== */
function evolvePlayers(team) {
  team.players.forEach(p => {
    if (p.age <= p.peak && Math.random() < 0.3) {
      if (Math.random() < 0.5) p.atk = Math.min(99, p.atk + 1);
      else p.def = Math.min(99, p.def + 1);
    }
    if (p.age > p.peak && Math.random() < 0.25) {
      if (Math.random() < 0.5) p.atk = Math.max(20, p.atk - 1);
      else p.def = Math.max(20, p.def - 1);
    }
  });
}

/* ================== PARTIDA ================== */
function playRound() {
  const m = schedule[currentRound];
  const h = teams.find(t => t.name === m.h);
  const a = teams.find(t => t.name === m.a);

  const hs = teamStats(h);
  const as = teamStats(a);

  const gh = calcGoals(hs.atk, as.def);
  const ga = calcGoals(as.atk, hs.def);

  h.gf += gh; h.ga += ga;
  a.gf += ga; a.ga += gh;

  if (gh > ga) h.pts += 3;
  else if (ga > gh) a.pts += 3;
  else { h.pts++; a.pts++; }

  teams.forEach(t => {
    evolvePlayers(t);
    t.players.forEach(p => p.age += 0.02);
  });

  money += 10;

  document.getElementById("output").innerHTML =
    `<h3>${h.name} ${gh} x ${ga} ${a.name}</h3>
     <small>Jogadores evoluÃ­ram / regrediram conforme a idade</small>`;

  currentRound++;
  document.getElementById("round").innerText = currentRound + 1;
  document.getElementById("money").innerText = money;
  saveGame();
}

/* ================== TELAS ================== */
function showSquad() {
  const team = teams.find(t => t.name === myTeam);
  let html = "<h3>ðŸ‘¥ Elenco</h3><table><tr><th>Nome</th><th>Pos</th><th>ATK</th><th>DEF</th><th>Idade</th></tr>";
  team.players.forEach(p => {
    html += `<tr><td>${p.name}</td><td>${p.pos}</td>
    <td>${p.atk}</td><td>${p.def}</td><td>${p.age.toFixed(1)}</td></tr>`;
  });
  html += "</table>";
  document.getElementById("output").innerHTML = html;
}

function showMarket() {
  let html = "<h3>ðŸ’¸ Mercado</h3>";
  teams.forEach(t => {
    if (t.name !== myTeam) {
      t.players.forEach(p => {
        html += `<p>${p.name} (${p.pos}) ${p.age.toFixed(1)} anos ðŸ’°$${p.price}
        <button onclick="buyPlayer('${t.name}','${p.name}')">Comprar</button></p>`;
      });
    }
  });
  document.getElementById("output").innerHTML = html;
}

function buyPlayer(teamName, playerName) {
  const buyer = teams.find(t => t.name === myTeam);
  const seller = teams.find(t => t.name === teamName);
  const idx = seller.players.findIndex(p => p.name === playerName);
  const p = seller.players[idx];

  if (money < p.price) return alert("Dinheiro insuficiente!");

  money -= p.price;
  buyer.players.push(p);
  seller.players.splice(idx, 1);
  document.getElementById("money").innerText = money;
  saveGame();
}

/* ================== CLASSIFICAÃ‡ÃƒO ================== */
function showTable() {
  let html = "<table><tr><th>Time</th><th>Pts</th></tr>";
  teams.slice().sort((a,b)=>b.pts-a.pts).forEach(t=>{
    html += `<tr class="${t.name===myTeam?'highlight':''}">
      <td>${t.name}</td><td>${t.pts}</td></tr>`;
  });
  html += "</table>";
  document.getElementById("output").innerHTML = html;
}

function newGame() {
  localStorage.removeItem(KEY);
  location.reload();
}

/* ================== INIT ================== */
if (loadGame()) showGame();
else setupSelection();
</script>

</body>
</html>
